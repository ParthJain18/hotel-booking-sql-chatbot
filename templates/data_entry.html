{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/data_entry.css') }}">
{% endblock %}

{% block content %}
<h1 class="margin-bottom">Add Hotel Booking Data</h1>

{% if request.query_params.get('success') %}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    Booking data added successfully!
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<form method="post" action="/data-entry/">
    <div class="form-section">
        <h4>Basic Information</h4>
        <div class="grid-row">
            <div class="grid-half">
                <label for="hotel" class="form-label">Hotel Type</label>
                <select class="form-select" id="hotel" name="hotel" required>
                    <option value="Resort Hotel">Resort Hotel</option>
                    <option value="City Hotel">City Hotel</option>
                </select>
            </div>
            <div class="grid-half">
                <label for="month" class="form-label">Month</label>
                <select class="form-select" id="month" name="month" required>
                    <option value="January">January</option>
                    <option value="February">February</option>
                    <option value="March">March</option>
                    <option value="April">April</option>
                    <option value="May">May</option>
                    <option value="June">June</option>
                    <option value="July">July</option>
                    <option value="August">August</option>
                    <option value="September">September</option>
                    <option value="October">October</option>
                    <option value="November">November</option>
                    <option value="December">December</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="grid-half">
                <label for="lead_time" class="form-label">Lead Time (days)</label>
                <input type="number" class="form-control" id="lead_time" name="lead_time" min="0" value="60" required>
            </div>
            <div class="grid-half">
                <label for="check_in_date" class="form-label">Check-in Date</label>
                <input type="date" class="form-control" id="check_in_date" name="check_in_date" required>
            </div>
        </div>

    </div>

    <div class="form-section">
        <h4>Stay Information</h4>
        <div class="grid-row">
            <div class="grid-half">
                <label for="stays_in_weekend_nights" class="form-label">Weekend Nights</label>
                <input type="number" class="form-control" id="stays_in_weekend_nights" name="stays_in_weekend_nights" min="0" value="1" required>
            </div>
            <div class="grid-half">
                <label for="stays_in_week_nights" class="form-label">Week Nights</label>
                <input type="number" class="form-control" id="stays_in_week_nights" name="stays_in_week_nights" min="0" value="0" required>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4>Guest Information</h4>
        <div class="grid-row">
            <div class="grid-third">
                <label for="adults" class="form-label">Adults</label>
                <input type="number" class="form-control" id="adults" name="adults" min="1" value="1" required>
            </div>
            <div class="grid-third">
                <label for="children" class="form-label">Children</label>
                <input type="number" class="form-control" id="children" name="children" min="0" value="0">
            </div>
            <div class="grid-third">
                <label for="babies" class="form-label">Babies</label>
                <input type="number" class="form-control" id="babies" name="babies" min="0" value="0">
            </div>
        </div>
        <div class="grid-row">
            <div class="grid-third">
                <label for="country" class="form-label">Country</label>
                <input type="text" class="form-control" id="country" name="country" value="IND" required>
            </div>
            <div class="grid-third">
                <label for="is_repeated_guest" class="form-label">Repeated Guest</label>
                <select class="form-select" id="is_repeated_guest" name="is_repeated_guest" required>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4>Room Information</h4>
        <div class="grid-row">
            <div class="grid-half">
                <label for="reserved_room_type" class="form-label">Reserved Room Type</label>
                <select class="form-select" id="reserved_room_type" name="reserved_room_type" required>
                    <option value="A">Type A</option>
                    <option value="B">Type B</option>
                    <option value="C">Type C</option>
                    <option value="D">Type D</option>
                    <option value="E">Type E</option>
                    <option value="F">Type F</option>
                    <option value="G">Type G</option>
                    <option value="H">Type H</option>
                </select>
            </div>
            <div class="grid-half">
                <label for="assigned_room_type" class="form-label">Assigned Room Type</label>
                <select class="form-select" id="assigned_room_type" name="assigned_room_type" required>
                    <option value="A">Type A</option>
                    <option value="B">Type B</option>
                    <option value="C">Type C</option>
                    <option value="D">Type D</option>
                    <option value="E">Type E</option>
                    <option value="F">Type F</option>
                    <option value="G">Type G</option>
                    <option value="H">Type H</option>
                </select>
            </div>
        </div>
        <div class="grid-row">
            <div class="grid-half">
                <label for="booking_changes" class="form-label">Booking Changes</label>
                <input type="number" class="form-control" id="booking_changes" name="booking_changes" min="0" value="0">
            </div>
            <div class="grid-half">
                <label for="days_in_waiting_list" class="form-label">Days in Waiting List</label>
                <input type="number" class="form-control" id="days_in_waiting_list" name="days_in_waiting_list" min="0" value="0">
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4>Financial Information</h4>
        <div class="grid-row">
            <div class="grid-half">
                <label for="adr" class="form-label">Average Daily Rate (â‚¬)</label>
                <input type="number" class="form-control" id="adr" name="adr" step="0.01" min="0" value="100" required>
            </div>
            <div class="grid-half">
                <label for="total_of_special_requests" class="form-label">Total Special Requests</label>
                <input type="number" class="form-control" id="total_of_special_requests" name="total_of_special_requests" min="0" value="0">
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4>Reservation Status</h4>
        <div class="grid-row">
            <div class="grid-half">
                <label for="reservation_status" class="form-label">Status</label>
                <select class="form-select" id="reservation_status" name="reservation_status" required>
                    <option value="Check-Out">Check-Out</option>
                    <option value="Canceled">Canceled</option>
                    <option value="No-Show">No-Show</option>
                </select>
            </div>
            <div class="grid-half">
                <label for="reservation_status_date" class="form-label">Status Date</label>
                <input type="date" class="form-control" id="reservation_status_date" name="reservation_status_date" required>
            </div>
        </div>
    </div>

    <div class="text-center margin-top margin-bottom">
        <button type="submit" class="btn btn-primary btn-large">Submit Booking Data</button>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    // Set default dates
    document.getElementById('reservation_status_date').valueAsDate = new Date();
    
    const nextMonth = new Date();
    nextMonth.setMonth(nextMonth.getMonth() + 1);
    document.getElementById('check_in_date').valueAsDate = nextMonth;
    
    // Update month field based on check-in date
    document.getElementById('check_in_date').addEventListener('change', function() {
        const date = new Date(this.value);
        const monthNames = ["January", "February", "March", "April", "May", "June",
                           "July", "August", "September", "October", "November", "December"];
        document.getElementById('month').value = monthNames[date.getMonth()];
    });
    
    // Set initial month value
    const initialDate = new Date(document.getElementById('check_in_date').value);
    const monthNames = ["January", "February", "March", "April", "May", "June",
                       "July", "August", "September", "October", "November", "December"];
    document.getElementById('month').value = monthNames[initialDate.getMonth()];
    
    // Copy reserved room type to assigned room type by default
    document.getElementById('reserved_room_type').addEventListener('change', function() {
        document.getElementById('assigned_room_type').value = this.value;
    });

    // Auto-calculate revenue (not stored visibly in form)
    function calculateRevenue() {
        const adr = parseFloat(document.getElementById('adr').value) || 0;
        const weekendNights = parseInt(document.getElementById('stays_in_weekend_nights').value) || 0;
        const weekNights = parseInt(document.getElementById('stays_in_week_nights').value) || 0;
        const totalNights = weekendNights + weekNights;
        
        return adr * totalNights;
    }
    
    document.getElementById('adr').addEventListener('input', calculateRevenue);
    document.getElementById('stays_in_weekend_nights').addEventListener('input', calculateRevenue);
    document.getElementById('stays_in_week_nights').addEventListener('input', calculateRevenue);
</script>
{% endblock %}